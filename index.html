<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Simulador de Lentes</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  margin: 0;
  background: #C7B89E; /* areia */
  color: #222;
}
.container {
  max-width: 900px;
  margin: auto;
  padding: 20px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.card {
  background: #fff;
  border-radius: 16px;
  padding: 30px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  text-align: center;
  animation: fadeIn 0.5s ease;
}
h2 {
  color: #37184A; /* roxo */
  margin-bottom: 20px;
}
.options {
  display: flex;
  flex-wrap: wrap;
  justify-content: center; /* sempre centralizado */
  gap: 20px;
  padding: 10px;
}
.options.scroll-x {
  flex-wrap: nowrap;
  overflow-x: auto;
  justify-content: flex-start;
}
.option {
  background: #f5f0eb;
  border: 2px solid transparent;
  border-radius: 12px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  flex: 1 1 200px;
  max-width: 220px;
  min-width: 200px;
}
.option img {
  width: 100%;
  max-height: 140px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 10px;
}
.option:hover { border: 2px solid #37184A; background: #fdfcff; }
.selected { border: 2px solid #37184A; background: #f3eafc; }
.buttons { display: flex; justify-content: space-between; margin-top: 20px; }
.buttons.first-step { justify-content: flex-end; }
button {
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: 0.3s;
}
.next { background: #37184A; color: white; }
.next:hover { background: #2a1239; }
.prev { background: #ddd; }
.prev:hover { background: #bbb; }
.price-box {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #37184A;
  color: #fff;
  padding: 15px 20px;
  border-radius: 12px;
  font-size: 18px;
  font-weight: bold;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  cursor: pointer;
  transition: 0.3s;
}
.price-box:hover { background: #2a1239; }
.summary p { margin: 8px 0; }
.summary a { color: #37184A; text-decoration: underline; cursor: pointer; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* --- Logo no canto superior esquerdo --- */
.logo {
  position: fixed;
  top: 20px;
  left: 20px;
  height: 50px;
}
</style>
</head>
<body>

<!-- Logo -->
<img src="https://i.imgur.com/MvoHTsc.png" alt="Logo" class="logo">

<div class="container">
  <div class="price-box" onclick="goToSummary()">Total: R$ <span id="total">0.00</span></div>
  <div class="card" id="step-container"></div>
</div>

<script>
const imgPath = "https://cdn.awsli.com.br/600x700/919/919087/produto/303480926/6335-0j0ljjtpd0.png";

// ---- Tabelas de Preços ----
const pricesMultifocal = {
  multifocal: 600, digital: 0, access: 200, shift: 400, loud: 600,
  resina: 0, policarbonato: 200, "1.67": 400, "1.74": 600,
  incolor: 0, comum: 150, premiumAR: 300,
  azul: 200, escurecimento: 300
};
const pricesSurfacada = {
  simples: 300, surfacada: 150,
  resina: 0, policarbonato: 150, "1.67": 300, "1.74": 500,
  incolor: 0, comum: 120, premiumAR: 250,
  azul: 180, escurecimento: 250
};
const pricesPronta = {
  simples: 200, pronta: 0,
  resina: 0, policarbonato: 100, "1.67": 250, "1.74": 400,
  incolor: 0, comum: 100, // premium bloqueado
  azul: 150, escurecimento: 200
};

let prices = {};

const steps = [
  { title: "Qual tipo de lente deseja?", options: [
      { label:"Visão Simples", value:"simples", img:imgPath },
      { label:"Multifocal", value:"multifocal", img:imgPath }
  ]},
  { title:"Escolha o tipo de lente", 
    optionsSimples:[
      { label:"Lente pronta", value:"pronta", img:imgPath },
      { label:"Surfaçada", value:"surfacada", img:imgPath }
    ],
    optionsMultifocal:[
      { label:"Blut Digital", value:"digital", img:imgPath },
      { label:"Blut Access", value:"access", img:imgPath },
      { label:"Blut Shift", value:"shift", img:imgPath },
      { label:"Blut Loud", value:"loud", img:imgPath }
    ], 
  },
  { title:"Escolha o material", options:[
      { label:"Resina", value:"resina", img:imgPath },
      { label:"Policarbonato", value:"policarbonato", img:imgPath },
      { label:"1.67", value:"1.67", img:imgPath },
      { label:"1.74", value:"1.74", img:imgPath }
    ], forceScrollX:true
  },
  { title:"Escolha o anti-reflexo", options:[
      { label:"Incolor", value:"incolor", img:imgPath },
      { label:"Comum", value:"comum", img:imgPath },
      { label:"Premium", value:"premiumAR", img:imgPath }
  ]},
  { title:"Deseja filtro de luz azul?", options:[
      { label:"Não", value:"naoAzul", img:imgPath },
      { label:"Sim", value:"azul", img:imgPath }
  ]},
  { title:"Deseja escurecimento da lente?", options:[
      { label:"Não", value:"naoEsc", img:imgPath },
      { label:"Sim", value:"escurecimento", img:imgPath }
  ]},
  { title:"Resumo Final", options:[]}
];

let currentStep = 0;
let selections = {};

function renderStep() {
  const container=document.getElementById("step-container");
  container.innerHTML="";
  const step=steps[currentStep];

  const title=document.createElement("h2");

  // Texto dinâmico para passo 2
  if(currentStep===1){
    if(selections[0]?.value==="simples"){
      title.textContent="Escolha o tipo de lente";
    } else {
      title.textContent="Escolha o campo de visão da lente";
    }
  } else {
    title.textContent=step.title;
  }

  container.appendChild(title);

  const optionsBox=document.createElement("div");
  optionsBox.className="options";
  // aplica scroll-x só no caso de multifocal no passo 2, ou quando for explicitamente marcado no objeto
if((currentStep === 1 && selections[0]?.value === "multifocal") || (currentStep === 2) || step.forceScrollX){
  optionsBox.classList.add("scroll-x");
}

  if(currentStep===1){
    const prevChoice=selections[0]?.value;
    if(prevChoice==="simples"){
      step.optionsSimples.forEach(opt=>{
        if(!isBlocked(opt.value)) createOption(opt,optionsBox);
      });
    } else {
      step.optionsMultifocal.forEach(opt=>{
        if(!isBlocked(opt.value)) createOption(opt,optionsBox);
      });
    }
  } else if(currentStep===steps.length-1){
    const summary=document.createElement("div");
    summary.className="summary";
    summary.style.textAlign="left";
    summary.innerHTML="<h3>Resumo da sua escolha:</h3>";
    let totalFinal=0;
    steps.forEach((s,i)=>{
      if(selections[i]){
        const opt=selections[i];
        const price=prices[opt.value]||0;
        summary.innerHTML+=`<p><b><a onclick="goToStep(${i})">${s.title}</a></b>: ${opt.label} (R$${price})</p>`;
        totalFinal+=price;
      }
    });
    summary.innerHTML+=`<h2>Total Final: R$${totalFinal}</h2>`;
    container.appendChild(summary);
  } else {
    step.options.forEach(opt=>{
      if(!isBlocked(opt.value)) createOption(opt,optionsBox);
    });
  }

  if(currentStep!==steps.length-1) container.appendChild(optionsBox);

  const buttons=document.createElement("div");
  buttons.className="buttons";
  if(currentStep===0) buttons.classList.add("first-step");

  if(currentStep>0){
    const prevBtn=document.createElement("button");
    prevBtn.textContent="Voltar";
    prevBtn.className="prev";
    prevBtn.onclick=()=>{ currentStep--; renderStep(); };
    buttons.appendChild(prevBtn);
  }
  if(currentStep<steps.length-1){
    const nextBtn=document.createElement("button");
    nextBtn.textContent="Avançar";
    nextBtn.className="next";
    nextBtn.onclick=()=>{
      if(!selections[currentStep]){ alert("Selecione uma opção para continuar."); return; }
      currentStep++; renderStep();
    };
    buttons.appendChild(nextBtn);
  }
  container.appendChild(buttons);
  updateTotal();
}

function createOption(opt,parent){
  const div=document.createElement("div");
  div.className="option";
  const price=prices[opt.value]||0;
  div.innerHTML=`<img src="${opt.img}" alt="${opt.label}"><p>${opt.label}<br><b>R$${price}</b></p>`;
  div.onclick=()=>{
    selections[currentStep]=opt;
    document.querySelectorAll(".option").forEach(el=>el.classList.remove("selected"));
    div.classList.add("selected");
    updateTotal();
  };
  parent.appendChild(div);
}

function goToStep(stepIndex){ currentStep=stepIndex; renderStep(); }
function goToSummary(){ currentStep=steps.length-1; renderStep(); }

function updateTotal(){
  let total=0;
  Object.values(selections).forEach(opt=>{ if(opt) total+=prices[opt.value]||0; });
  document.getElementById("total").textContent=total.toFixed(2);
}

// ---- Definir tabela de preços ----
function definePriceTable(){
  if(selections[0]?.value==="multifocal"){ prices=pricesMultifocal; }
  else if(selections[0]?.value==="simples" && selections[1]?.value==="surfacada"){ prices=pricesSurfacada; }
  else if(selections[0]?.value==="simples" && selections[1]?.value==="pronta"){ prices=pricesPronta; }
}

// ---- Regras de bloqueio ----
function isBlocked(value){
  // Premium bloqueado para lente pronta
  if(selections[0]?.value==="simples" && selections[1]?.value==="pronta" && value==="premiumAR"){ return true; }
  // Material 1.74 pronta não pode escurecimento
  if(selections[1]?.value==="pronta" && selections[2]?.value==="1.74" && value==="escurecimento"){ return true; }
  // Material 1.67 ou 1.74 prontas não pode incolor
  if(selections[1]?.value==="pronta" && (selections[2]?.value==="1.67"||selections[2]?.value==="1.74") && value==="incolor"){ return true; }
  // Material 1.67 surfaçada : filtro azul e escurecimento não podem juntos
  if((selections[0]?.value==="multifocal" || selections[1]?.value==="surfaçada") && selections[2]?.value==="1.67" && selections[4]?.value==="azul" && value==="escurecimento"){ return true; }
  if((selections[0]?.value==="multifocal" || selections[1]?.value==="surfaçada") && selections[2]?.value==="1.67" && selections[5]?.value==="escurecimento" && value==="azul"){ return true; }
  return false;
}

renderStep();
</script>
</body>
</html>

